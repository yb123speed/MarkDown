# RESTful API

API 基本格式 `http://<ip|domain>:<port>/<索引>/<类型>/<文档id>`

常用HTTP动词 `GET/PUT/POST/DELETE`

---

## Index API （索引 API）

### 创建索引api

request:

`PUT <索引名>`

response:

```json
{
    "acknowledged": true,
    "shards_acknowledged": true,
    "index": "<索引名>"
}
```

### 查看现有索引api

request:

`GET _cat/indices`

### 删除索引api

request:

`DELETE <索引名>`

response:

```json
{
    "acknowledged": true
}
```

---

## Document API （文档索引）

### 创建文档1（指定id）

request:

`PUT <索引名>/<类型>/<id>`

```http
PUT test_index/type/1
{
    "username": "alfred",
    "age": 1
}
```

注：创建文档时，如果索引不存在，es会自动创建对应的index和type

response:

```json
{
    "_index": "test_index",
    "_type": "doc",
    "_id": 1,
    "version": 1,
    "result": "created",
    "_shards": {
        "total": 2,
        "successful": 1,
        "failed": 0
    },
    "_seq_no": 0,
    "_primary_term": 1
}
```

### 创建文档2（不指定id）

request:

`POST <索引名>/<类型>`

```http
POST test_index/type
{
    "username": "tom",
    "age": 20
}
```

response:

```json
{
    "_index": "test_index",
    "_type": "doc",
    "_id": "Pn53w2kBzwKTTvIQgjZI",
    "_version": 1,
    "result": "created",
    "_shards": {
        "total": 2,
        "successful": 1,
        "failed": 0
    },
    "_seq_no": 0,
    "_primary_term": 1
}
```

### 查询指定文档API

request:

`GET test_index/doc/1`

response:

status 200

```json
{
    "_index": "test_index",
    "_type": "doc",
    "_id": "1",
    "_version": 1,
    "_seq_no": 0,
    "_primary_term": 1,
    "found": true,
    "_source": {
        "username": "alfred",
        "age": 1
    }
}
```

status 404

```json
{
    "_index": "test_index",
    "_type": "doc",
    "_id": "2",
    "found": false
}
```

### 查询所有文档API

request:

条件查询并分页

```http
GET test_index/doc/_search
{
    "query":{
        "match_all": {}
    },
    // 以下两字段作用为分页
    "from": 1,
    "size": 1,
    // Sort 排序字段
    "sort": [
        {"age": {"order":"desc"}}
    ]
}
```

```http
GET test_index/doc/_search
{
    "query":{
        "term":{
            "_id":"1"
        }
    }  
}
```

注：不加Json条件则查询所有

response:

```json
{
    // 查询耗时
    "took": 5,
    "timed_out": false,
    "_shards": {
        "total": 5,
        "successful": 5,
        "skipped": 0,
        "failed": 0
    },
    "hits": {
        // 符合条件的总文档数
        "total": 1,
        "max_score": 1,
        // 返回的文档详情数据数组，默认前10个文档
        "hits": [
            {
                "_index": "test_index",
                "_type": "doc",
                "_id": "1",
                "_score": 1,
                "_source": {
                    "username": "alfred",
                    "age": 1
                }
            }
        ]
    }
}
```

### 修改文档API

直接修改

request:

```http
POST /test_index/doc/1/_update
{
    // 这儿的doc是保留字不是url中的类型doc
    "doc":{
        "username":"alfred1"
    }  
}
```

response:

```json
{
    "_index": "test_index",
    "_type": "doc",
    "_id": "1",
    "_version": 3,
    "result": "updated",
    "_shards": {
        "total": 2,
        "successful": 1,
        "failed": 0
    },
    "_seq_no": 2,
    "_primary_term": 1
}
```

脚本修改

request:

```http
POST /test_index/doc/1/_update
{
    "script": {
        "lang": "painless",
        "inline": "ctx._source.age+=10"
    }
}
```

```http
POST /test_index/doc/1/_update
{
    "script": {
        "lang": "painless",
        "inline": "ctx._source.age = params.age",
        "params": {
            "age": 100
        }
    }
}
```

response:

```json
{
    "_index": "test_index",
    "_type": "doc",
    "_id": "1",
    "_version": 4,
    "result": "updated",
    "_shards": {
        "total": 2,
        "successful": 1,
        "failed": 0
    },
    "_seq_no": 3,
    "_primary_term": 1
}
```